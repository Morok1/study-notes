<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Network security</title>
<meta name="author" content="("Mikhail Volkhov")"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/simple.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'http://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Network security</h1><h2 class="author">"Mikhail Volkhov"</h2><p class="date">Created: 2016-10-25 Tue 19:59</p>
</section>
<section id="table-of-contents">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#/slide-orgheadline1">Disclaimer</a></li>
<li><a href="#/slide-orgheadline6">Network security in general</a></li>
<li><a href="#/slide-orgheadline27">IPsec</a></li>
<li><a href="#/slide-orgheadline38">TLS/SSL</a></li>
<li><a href="#/slide-orgheadline39">That's all, thank you</a></li>
<li><a href="#/slide-orgheadline40">Resources</a></li>
</ul>
</div>
</div>
</section>

<section>
<section id="slide-orgheadline1">
<h2 id="orgheadline1">Disclaimer</h2>
<p>
I'm by no means a computer security specialist. Both these slides
and the lecture itself can contain pure bullshit.
</p>

<p>
BTW these slides &amp; plain html version are available here:
</p>

<p>
<a href="https://github.com/volhovM/study-notes/blob/master/networks/presentation-solid.html">github:volhovm/study-notes/networks</a>
</p>
</section>
</section>
<section>
<section id="slide-orgheadline6" data-background="#bfceff">
<h2 id="orgheadline6">Network security in general</h2>
<p style="font-size:75%;">
Network security by definition is a set of policies that are used to
prevent and monitor unauthorized access, misuse, &#x2026; or denial of
network-accessible resources.
</p>
</section>
</section>
<section>
<section id="slide-orgheadline2">
<h3 id="orgheadline2">Different types of attacks</h3>
<ul>
<li>Passive
Intercepts data traveling through the network:
<ul>
<li>Tapping (wiretapping)</li>
<li>Port scanning</li>

</ul></li>
<li>Active
Intruder imitates commands to disrupt network's normal state.
<ul>
<li>Denial-of-service</li>
<li>MITM (Man-in-the-middle)</li>
<li>Injections (SQL)</li>
<li>DNS spoofing</li>
<li>.. lots of them</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline3">
<h3 id="orgheadline3">What do we have do to then?</h3>
<p style="font-size:95%;">
Different attacks need different solutions. Most general advices:
</p>
<ul>
<li>OS level: Using OS that is aware of last CVE updates (last
kernels etc). Using different environments for service
nodes. Hiring good system administrator.</li>
<li>Application level sanity (e.g. blocking arbitrary user to make
you allocate GBs of memory on a simple HTTP request).</li>
<li>Transport/network security: using solutions that
encrypt/route/mix your traffic.</li>
<li>IT security audits. Automatic testing with audit software
(argmitage's hail mary etc).</li>

</ul>
<p>
We'll mostly speak about cryptography applications further.
</p>
</section>
</section>
<section>
<section id="slide-orgheadline4">
<h3 id="orgheadline4">Security on different network levels</h3>

<div class="figure">
<p><img src="./security_levels.png" alt="security_levels.png" height="250" align="center" style="border:none; box-shadow:none;" />
</p>
</div>
<ul>
<li>Network level security (IPsec) works with everything IP carries
inside (UDP, TCP, ICMP).</li>
<li>IPsec protects <i>whole</i> IP payload, including headers.</li>
<li>Both are independent of content inside (payload).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline5">
<h3 id="orgheadline5">Topics for today</h3>
<ol>
<li>IPsec: how to encrypt ip and build VPNs (network level security)</li>
<li>TLS/SSL: security on the transport level.</li>

</ol>
</section>
</section>
<section>
<section id="slide-orgheadline27" data-background="#bfceff">
<h2 id="orgheadline27">IPsec</h2>
</section>
</section>
<section>
<section id="slide-orgheadline7">
<h3 id="orgheadline7">In general</h3>
<ul>
<li>Set of protocols for securing network connection on ip level.</li>
<li>Very complicated, lots of different knobs and modes.</li>
<li>AH (Authentication header) and ESP (Encapsulating Security
Payload) protocols.</li>
<li>Wide range of cryptography primitives for auth/encryption
supported.</li>
<li>Tunnel mode versus Transport mode.</li>
<li>Manual keys exchange vs IKE.</li>

</ul>

</section>
<section>
<p>
Security on ip level encompasses three functional areas:
</p>
<ol>
<li>Authentication and integrity checks
<ul>
<li>Data is sent from the user you think it's sent from.</li>
<li>It's not altered.</li>
<li>Something is done to prevent replay attacks.</li>

</ul></li>
<li>Encryption &#x2013; anything between is secured.</li>
<li>Key management &#x2013; secure exchange of keys to encrypt.</li>

</ol>
</section>
</section>
<section>
<section id="slide-orgheadline8">
<h3 id="orgheadline8">Motivation</h3>
<p>
Companies often want private networks for security.
</p>
<ol>
<li>Physical local network &#x2013; expensive. Separate routers, links,
DNS infrastructure.</li>
<li>VPN &#x2013; all traffic is sent over the Internet, encrypted outside
of local networks, logically separated from the other traffic.</li>

</ol>
</section>
</section>
<section>
<section id="slide-orgheadline9">
<h3 id="orgheadline9">Benefits of IPsec:</h3>
<ol>
<li>Absolutely transparent to applications:
<ul>
<li>No need to have explicit authentication system as it's done in
VPN solutions (which includes issuing auth info and then
revoking it when, for example, employee leaves organization).</li>
<li>Software independence &#x2013; IPsec is implemented on OS level and
routers don't have much to do with one's userspace (compare
with (SSL-/SSH-/PGP-based VPN system).</li>

</ul></li>
<li>Adding cool features to routing architecture (can ensure that
router and neighbour advertisements come from authorized
routers; same for redirect messages, routing updates)</li>

</ol>
</section>
</section>
<section>
<section id="slide-orgheadline10">
<h3 id="orgheadline10">IP Header</h3>

<div class="figure">
<p><img src="./ip_header.gif" alt="ip_header.gif" style="border:none; box-shadow:none; margin-right:20px; float:left; width: 36%;" />
</p>
</div>

<ul style="float:right; width:55%; font-size:70%;">
<li><code>ver = 4</code>. IPsec supports IPv6 as well, but it won't be covered
in this lecture.</li>
<li><code>hlen</code> &#x2013; length of header (minimum 5, can be more to include ip options).</li>
<li><code>pkt len</code> &#x2013; length of payload (up to \(2^{16}\) bytes).</li>
<li><code>ID</code>, <code>frag offset</code> &#x2013; fragmentation-related fields.</li>
<li><code>proto</code> &#x2013; protocol of carried data.</li>
<li>Checksum is non-secure trivial algorithm (fast &amp; simple tho).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline11">
<h3 id="orgheadline11">Proto codes</h3>
<p style="font-size: 80%;">
Defined by Internet Assigned Numbers Authority (IANA): <a href="https://en.wikipedia.org/wiki/List_of_IP_protocol_numbers" style="font-size: 80%;">Full list</a>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" style="font-size: 70%;">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Protocol code</th>
<th scope="col" class="org-left">Protocol Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">ICMP — Internet Control Message Protocol</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">IGMP — Internet Group Management Protocol</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">IP within IP (a kind of encapsulation)</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">TCP — Transmission Control Protocol</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-left">UDP — User Datagram Protocol</td>
</tr>

<tr>
<td class="org-right">41</td>
<td class="org-left">IPv6 — next-generation TCP/IP</td>
</tr>

<tr>
<td class="org-right">47</td>
<td class="org-left">GRE — Generic Router Encapsulation (used by PPTP)</td>
</tr>

<tr>
<td class="org-right">50</td>
<td class="org-left">IPsec: ESP — Encapsulating Security Payload</td>
</tr>

<tr>
<td class="org-right">51</td>
<td class="org-left">IPsec: AH — Authentication Header</td>
</tr>
</tbody>
</table>
</section>
</section>
<section>
<section id="slide-orgheadline12">
<h3 id="orgheadline12">IPsec protocol types</h3>
<ul>
<li>Authentication Header (AH) protocol:
<ul>
<li>Source authentication, data integrity</li>

</ul></li>
<li>Encapsulation Security Protocol (ESP)
<ul>
<li>Authentication, integrity, confidentiality</li>
<li>Much more popular</li>

</ul></li>
<li>Host/transport mode &#x2013; data is exchanged between two hosts.</li>
<li>Tunnel mode &#x2013; inner payload is IP datagram, so after it's
unwrapped (decrypted, checked), it's sent to the destination ip.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline13">
<h3 id="orgheadline13">Four combinations of protocol modes</h3>

<div class="figure">
<p><img src="./ipsec_modes.png" alt="ipsec_modes.png" style="border:none; box-shadow:none; width: 90%;" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgheadline14">
<h3 id="orgheadline14">Authentication header</h3>

<div class="figure">
<p><img src="./ipsec_ah.gif" alt="ipsec_ah.gif" style="border:none; box-shadow:none; float:center; width: 32%" />
</p>
</div>

<ul style="font-size:70%;">
<li><code>next hdr</code> &#x2013; protocol type of the payload.</li>
<li><code>reserved</code> &#x2013; must be filled by zero by sender, ignored by
recipient. For the future use.</li>
<li><code>SPI</code> &#x2013; value used to identify the security association. That
implies a choose of hash algorithm, secret data and other
parameters.</li>
<li><code>Sequence number</code> &#x2013; anti replay protection, included in the
Authentication Data</li>
<li><code>Authentication Data</code> &#x2013; hash of many packet fields (including
both payload and IP headers).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline15">
<h3 id="orgheadline15">Security associations (SA)</h3>
<ul style="font-size:80%;">
<li>Establishment of shared security atributes between two
entities. <i>Simplex</i> (one-way): one SA per algorithm/direction.</li>
<li>Unlike IP, IPsec is connection-oriented.</li>
<li>SA is uniquely identified by the following tuple: \(SA ~ (SPI, IPdest, protId)\)
<ul>
<li>SPI (Security Parameters Index): local significance id of SA
set on receiver side.</li>
<li>IPDest &#x2013; router address, broadcast,..</li>
<li>\(protId \in \{AH, ESP\}\)</li>

</ul></li>
<li>Internet Key Exchange (IKE) is a protocol used for setting SA.</li>
<li>Security Association Database (SAD) &#x2013; local database that stores
\(≈ 2n\) entries for \(n\) neighbours (\(n\) for sending, \(n\) for
receiving).</li>

</ul>

</section>
<section>
<p>
Parameters associated with SA (lots of them):
</p>
<ul>
<li>AH/ESP Information &#x2013; authentication, encryption methods and
algorithms, keys, their lifetimes.</li>
<li>Sequence number counter.</li>
<li>Lifetime of the SA.</li>
<li>IPsec protocol mode (tunnel/transport).</li>
<li>Routing restrictions.</li>
<li><i>Many</i> key-exchange parameters.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline16">
<h3 id="orgheadline16">IPsec AH Transport mode</h3>

<div class="figure">
<p><img src="./ipsec_ah_transport.gif" alt="ipsec_ah_transport.gif" height="540" style="border:none; box-shadow:none; float:center;" />
</p>
</div>

</section>
<section>
<ul>
<li>Just a secure IP connection, no tunneling.</li>
<li>Unwrap the packet, replace <code>proto</code> field of IP package and you're
ready.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline17">
<h3 id="orgheadline17">IPSec AH Tunnel mode</h3>

<div class="figure">
<p><img src="./ipsec_ah_tunnel.gif" alt="ipsec_ah_tunnel.gif" height="600" style="border:none; box-shadow:none; float:center;" />
</p>
</div>

</section>
<section>
<ul>
<li>Fair tunnel mode.</li>
<li>Authentication Data secures whole encapsulated IP datagram.</li>
<li>After the packet is processed and unpacked, it's routed
elsewhere.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline18">
<h3 id="orgheadline18">Transport/tunnel difference</h3>
<ul>
<li>There's no explicit mode field in IPsec. What distinguishes modes
is <code>next</code> field in IPsec header.</li>
<li>Any value that doesn't equal <code>IP</code> (e.g. <code>TCP</code>, <code>ICMP</code>, <code>UDP</code>) is
transport mode.</li>
<li>Top level of IP datagram doesn't change \(⇒\) intermediate routers
treat all kinds of IPsec/AH traffic identically without deeper
inspection.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline19">
<h3 id="orgheadline19">Authentication algorithms</h3>
<ul>
<li>AH carries Integrity Check Value in Authentication Data field of
the header. It's usually MD5 or SHA1.</li>
<li>Because users share keys with the help of CA, they can use wider
range of crypto algorithms. HMAC (Hashed Message Authentication
Code) is popular one.</li>
<li>HMAC computes hash given message and a shared symmetric secret
key, so noone without its knowledge can check the hash.</li>

</ul>

</section>
<section>

<div class="figure">
<p><img src="./ipsec_hmac.png" alt="ipsec_hmac.png" height="500" style="border:none; box-shadow:none; float:center;" />
</p>
</div>

</section>
<section>

<div class="figure">
<p><img src="./ipsec_hmac.gif" alt="ipsec_hmac.gif" height="600" style="border:none; box-shadow:none; float:center;" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgheadline20">
<h3 id="orgheadline20">AH/Nat incompatibility</h3>

<div class="figure">
<p><img src="./ipsec_ah_nat.gif" alt="ipsec_ah_nat.gif" style="border:none; box-shadow:none; margin-right:20px; float:right; width: 32%;" />
</p>
</div>

<ul style="float:left; width:60%; font-size:70%;">
<li>TTL is <i>always</i> changed so it's not included into Authentication
Data field. Header checksum is re-calculated on hop, it's not in
the AD field either.</li>
<li>NAT requires IP source/destination rewriting, but they are
included into Authentication Data.</li>
<li>Therefore AH in both transport and tunnel modes is completely
incompatible with NAT</li>
<li>ESP handles NAT way better, but it's still challenging (e.g. NAT
requires TCP info which is encrypted and thus not accessible).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline21">
<h3 id="orgheadline21">Encapsulating Security Payload (ESP)</h3>

<div class="figure">
<p><img src="./ipsec_esp_w_auth.gif" alt="ipsec_esp_w_auth.gif" style="border:none; box-shadow:none; margin-right:20px; float:left; width: 32%; vertical-align:middle;" />
</p>
</div>

<ul style="float:right; width:60%; font-size:65%; vertical-align:middle;">
<li>Provides authenticity, integrity and confidentiality. ESP
Auth-only or Encryption-only modes can be used (e.g. no
Authentication data field or using <code>NULL</code> encryption algorithm),
but strongly discouraged. Presense/absense of Authentication Data
is determined by looking at SPI.</li>
<li>Surrounds the payload rather then preceeding.</li>
<li><code>padding</code> is used for encryption algorithms to match their block
size. <code>pad len</code> is length of a padding.</li>
<li>Different supported encryption algorithms: AES, 3DES, Blowfish.</li>
<li>Authentication Header covers ESP Header and encrypted payload.</li>
<li>Type of payload (<code>next</code> field) is encrypted inside too. Headers
don't reveal any info about the type.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline22">
<h3 id="orgheadline22">ESP Transport mode</h3>

<div class="figure">
<p><img src="./ipsec_esp_transport.gif" alt="ipsec_esp_transport.gif" height="540" style="border:none; box-shadow:none;" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgheadline23">
<h3 id="orgheadline23">ESP Tunnel mode</h3>

<div class="figure">
<p><img src="./ipsec_esp_tunnel.gif" alt="ipsec_esp_tunnel.gif" height="540" style="border:none; box-shadow:none;" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgheadline24">
<h3 id="orgheadline24">VPN</h3>

<div class="figure">
<p><img src="./ipsec_traditional_vpn.gif" alt="ipsec_traditional_vpn.gif" style="border:none; box-shadow:none; margin-right:20px; float:left; width: 30%; vertical-align:middle;" />
</p>
</div>

<ul style="float:right; width:65%; font-size:65%;">
<li>Purpose: join two trusted networks across an untrusted
intermediate network.</li>
<li>Which modes are available?
<ol style="font-size:80%;">
<li>ESP with authentication: doesn't authenticate mutable parts
of IP header, applies encryption before authentication.</li>
<li>ESP w/o authentication inside AH: authenticates mutable parts
of IP header, but 2 CA.</li>
<li>AH inside ESP w/o authentication: authentication header is
protected by encryption, authentication applies to the
plaintext (no need to recompute if reencrypted).</li>

</ol></li>
<li>Which one is best?
<ul style="font-size:80%;">
<li>AH NAT whoop-whoop \(⇒\) definitely not the thing we want to have
outside, so (2) is out.</li>
<li>(3) is too complex, plus still 2 CA.</li>
<li>In fact, IP header protection doesn't matter so much
(intermediate routers can't check header integrity because of
HMAC, anyway ESP can provide this security by wrapping IP
datagram).</li>
<li>Full ESP in tunnel mode is a winner.</li>

</ul></li>
<li>There are three major families of VPN in wide usage today: SSL
(OpenVPN, Cisco's AnyConnect), IPSec (OS level, ipsec-tools,
libre/open/strongSwan), PPTP (<a href="http://security.stackexchange.com/a/45510">Vulnerabilities list</a>).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline25">
<h3 id="orgheadline25">IKE in short</h3>
<ul style="font-size:80%;">
<li>Manual establishment of IPsec SAs is impractical, so automated
secret exchange algorithms come in handy.</li>
<li>Authentication can be done it two ways:
<ol>
<li>Pre-Shared Secret (PSK): 2 SAs (authentication &amp; encryption
keys) are generated with symmetric encrypted connection.</li>
<li>Public Key Infrastructure (PKI) (X.509/PKCS#12 certificates +
asymmetric cryptography) &#x2013; same as TLS handshake.</li>

</ol></li>
<li>Two-phased algorithm:
<ol>
<li>Establishing bi-directional IKE SA (not IPsec SA):
<ul>
<li>Based on DH exchange (Oakley) &#x2013; expensive, but done once.</li>
<li>Main mode vs aggressive mode &#x2013; security/speed balance.</li>
<li>Derives 3 keys: for phase 2, for encryption and for
authentication.</li>

</ul></li>
<li>Using random and key from phase 1 to create IPSec shared keys
for AH and ESP SAs. Quick, can be done often.</li>

</ol></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline26">
<h3 id="orgheadline26">Summary</h3>
<p>
Features:
</p>
<ul>
<li>IKE to establish shared keys, algorithms, SPI numbers.</li>
<li>AH vs ESP, Tunnel vs Transport, ESP tunnel is used mostly.</li>
<li>Security Associations (SA) &#x2013; network-level logical channel.</li>

</ul>

<p>
Disadvantages:
</p>
<ul>
<li>Excessive complexity of protocol \(⇒\) compatibility issues, broken
algorithms.</li>
<li>AH doesn't work with NAT.</li>
<li>Authenticates host, not user.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline38" data-background="#bfceff">
<h2 id="orgheadline38">TLS/SSL</h2>
</section>
</section>
<section>
<section id="slide-orgheadline28">
<h3 id="orgheadline28">General properties</h3>
<ul>
<li>Transport/application-level security protocol (encryption,
authentication, integrity), over TCP (DTLS &#x2013; over UDP).</li>
<li>SSL 1.0 &#x2013; 3.0 (up to 1996) &#x2013; old standards, TLS 1.0-1.2
current. Both refered to as SSL sometimes. TLS 1.2 is mostly
used, TLS 1.3 features x25519, removing md5/SHA-224 support,
removing support for broken older elliptic curves.</li>
<li><i>Lots</i> of different supported algorithms.</li>
<li>Libraries: openssl (2/3 of all web servers usage), libressl
(openssl fork), gnutls. Browsers use their own implementation
(NSS in firefox, SChannel (proprietary) on win).</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline29">
<h3 id="orgheadline29">Establishing a secure connection</h3>
<ul>
<li>Client always initiates the connection.</li>
<li>Handshake protocol, that has achieves following objectives:
<ol>
<li>Establish protocol variant to be used from the supported list
(SSLv3, TLSv1, TLSv1.1, TLSv1.2). Client suggests, server
chooses.</li>
<li>Send authentication data to user (X.509 certificate).</li>
<li>Establish a session ID.</li>
<li>Negotiate a Cipher Suite: key-exchange algo, bulk-data
encryption algo. Key exchange usually uses RSA/DSA/ECC
(expensive), so bulk data is encrypted with symmetric
encryption algo (key is transferred using asymmetric).</li>

</ol></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline34">
<h3 id="orgheadline34">X.509 Certificate</h3>
<ul style="font-size:80%;">
<li>Digital certificate &#x2013; handy way to state somebody owns a public
key.</li>
<li>Issued by Certificate Authority (CA): GlobalSign, Comodo,
LetsEncrypt (cross-signed by IdenTrust).</li>
<li>PKI (public key infrastructure) &#x2013; policy that regulates
certificate distribution and usage (including creation, web of
trust, revocation).</li>
<li>Trusted CA list is maintained by application. On linux can be
found under <code>/etc/ssl/certs/ca-certificates.crt</code>. Browsers use
their own lists.</li>
<li>Certificates are signed by other certificates, that propagates
trust.</li>

</ul>

</section>
<section>
<ul>
<li>Certificates can be revoked, system holds list of revoked certs
(CRL &#x2013; certificate revocation list). This list is held on CA
side and updated every N (~12) hours.</li>
<li>File format of owned keys:
<ol>
<li>Key is <code>.pem</code>, <code>.key</code> &#x2013; PEM format of DER, <code>.der</code> &#x2013; raw, not
widely used. PEM is ascii shielded.</li>
<li>Certificate is <code>.crt</code>, <code>.cer</code>, <code>.pem</code>, <code>.der</code> or <code>.p12</code>.</li>
<li>Files can be encrypted (private with AES) or unencrypted.</li>
<li>Sometimes cert chain is also attached.</li>

</ol></li>

</ul>
</section>
<section id="slide-orgheadline30">
<h4 id="orgheadline30">Obtaining certificate</h4>
<ol>
<li>User generates keypair and requests CA server.</li>
<li>CA responds with its certificate.</li>
<li>User collects information to obtain cert: email address,
fingerprints, etc. Pays moneyz (&lt;100$ or free).</li>
<li>User sends this data to CA signing with CA's public key.</li>
<li>CA verifies user's data and sends this certificate to user.</li>

</ol>
</section>
<section id="slide-orgheadline31">
<h4 id="orgheadline31">Certificate structure</h4>

<div class="figure">
<p><img src="./x509_cert.jpg" alt="x509_cert.jpg" height="550" style="border:none; box-shadow:none;" />
</p>
</div>
</section>
<section id="slide-orgheadline32">
<h4 id="orgheadline32">Certificate example (1)</h4>
<div class="org-src-container">

<pre  class="src src-haskell"><span style="color: #EF5C5F;">Certificate</span><span style="color: #8AAFFA;">:</span>
<span style="color: #333333;">  </span><span style="color: #EF5C5F;">Data:</span>
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Version:</span><span style="color: #333333;"> </span>3<span style="color: #333333;"> </span>(0x2)
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Serial</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Number:</span>
<span style="color: #333333;">    </span>bb<span style="color: #EF5C5F;">:</span>7c<span style="color: #EF5C5F;">:</span>54<span style="color: #EF5C5F;">:</span>9b<span style="color: #EF5C5F;">:</span>75<span style="color: #EF5C5F;">:</span>7b<span style="color: #EF5C5F;">:</span>28<span style="color: #EF5C5F;">:</span>9d
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Signature</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Algorithm:</span><span style="color: #333333;"> </span>sha1WithRSAEncryption
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Issuer:</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">C</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">MY</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">ST</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">STATE</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">O</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">CA</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">COMPANY</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">NAME</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">L</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">CITY</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">OU</span><span style="color: #A197BF;">=</span>X.509,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">CN</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">CA</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">ROOT</span>
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Validity</span>
<span style="color: #333333;">    </span><span style="color: #EF5C5F;">Not</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Before:</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Apr</span><span style="color: #333333;"> </span>15<span style="color: #333333;"> </span>22<span style="color: #EF5C5F;">:</span>21<span style="color: #EF5C5F;">:</span>10<span style="color: #333333;"> </span>2008<span style="color: #333333;"> </span><span style="color: #EF5C5F;">GMT</span>
<span style="color: #333333;">    </span><span style="color: #EF5C5F;">Not</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">After</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">:</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Mar</span><span style="color: #333333;"> </span>10<span style="color: #333333;"> </span>22<span style="color: #EF5C5F;">:</span>21<span style="color: #EF5C5F;">:</span>10<span style="color: #333333;"> </span>2011<span style="color: #333333;"> </span><span style="color: #EF5C5F;">GMT</span>
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Subject:</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">C</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">MY</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">ST</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">STATE</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">L</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">CITY</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">O</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">ONE</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">INC</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">OU</span><span style="color: #A197BF;">=</span><span style="color: #EF5C5F;">IT</span>,<span style="color: #333333;"> </span><span style="color: #EF5C5F;">CN</span><span style="color: #A197BF;">=</span>www<span style="color: #A197BF;">.</span>example<span style="color: #A197BF;">.</span>com
<span style="color: #333333;">   </span><span style="color: #EF5C5F;">Subject</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Public</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Key</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Info:</span>
<span style="color: #333333;">    </span><span style="color: #EF5C5F;">Public</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Key</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Algorithm:</span><span style="color: #333333;"> </span>rsaEncryption
<span style="color: #333333;">     </span><span style="color: #EF5C5F;">RSA</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Public</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Key:</span><span style="color: #333333;"> </span>(1024<span style="color: #333333;"> </span>bit)
<span style="color: #333333;">      </span><span style="color: #EF5C5F;">Modulus</span><span style="color: #333333;"> </span>(1024<span style="color: #333333;"> </span>bit)<span style="color: #EF5C5F;">:</span>
<span style="color: #333333;">       </span>00<span style="color: #EF5C5F;">:</span>ae<span style="color: #EF5C5F;">:</span>19<span style="color: #EF5C5F;">:</span>86<span style="color: #EF5C5F;">:</span>44<span style="color: #EF5C5F;">:</span>3c<span style="color: #EF5C5F;">:</span>dd<span style="color: #A197BF;">...</span>
<span style="color: #333333;">       </span><span style="color: #A197BF;">...</span>
<span style="color: #333333;">       </span>99<span style="color: #EF5C5F;">:</span>20<span style="color: #EF5C5F;">:</span>b8<span style="color: #EF5C5F;">:</span>f7<span style="color: #EF5C5F;">:</span>c0<span style="color: #EF5C5F;">:</span>9c<span style="color: #EF5C5F;">:</span>e8<span style="color: #A197BF;">...</span>
<span style="color: #333333;">       </span>38<span style="color: #EF5C5F;">:</span>c8<span style="color: #EF5C5F;">:</span>52<span style="color: #EF5C5F;">:</span>97<span style="color: #EF5C5F;">:</span>cc<span style="color: #EF5C5F;">:</span>76<span style="color: #EF5C5F;">:</span>c9<span style="color: #A197BF;">...</span>
<span style="color: #333333;">    </span><span style="color: #EF5C5F;">Exponent:</span><span style="color: #333333;"> </span>65537<span style="color: #333333;"> </span>(0x10001)
</pre>
</div>
</section>
<section id="slide-orgheadline33">
<h4 id="orgheadline33">Certificate example (2)</h4>
<div class="org-src-container">

<pre  class="src src-haskell"><span style="color: #EF5C5F;">X509v3</span><span style="color: #333333;"> </span>extensions<span style="color: #EF5C5F;">:</span>
<span style="color: #333333;"> </span><span style="color: #EF5C5F;">X509v3</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Basic</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Constraints:</span>
<span style="color: #333333;">  </span><span style="color: #EF5C5F;">CA:FALSE</span>
<span style="color: #EF5C5F;">Netscape</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Comment:</span>
<span style="color: #333333;"> </span><span style="color: #EF5C5F;">OpenSSL</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Generated</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Certificate</span>
<span style="color: #EF5C5F;">X509v3</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Subject</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Key</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Identifier:</span>
<span style="color: #333333;"> </span><span style="color: #EF5C5F;">EE:D9:</span>4<span style="color: #EF5C5F;">A:</span>74<span style="color: #EF5C5F;">:</span>03<span style="color: #EF5C5F;">:AC:</span><span style="color: #A197BF;">FB...</span>
<span style="color: #EF5C5F;">X509v3</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Authority</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Key</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Identifier:</span>
<span style="color: #333333;"> </span>keyid<span style="color: #EF5C5F;">:</span>54<span style="color: #EF5C5F;">:</span>0<span style="color: #EF5C5F;">D:DE:E3:</span>37<span style="color: #A197BF;">...</span>

<span style="color: #EF5C5F;">Signature</span><span style="color: #333333;"> </span><span style="color: #EF5C5F;">Algorithm:</span><span style="color: #333333;"> </span>sha1WithRSAEncryption
<span style="color: #333333;"> </span>52<span style="color: #EF5C5F;">:</span>3d<span style="color: #EF5C5F;">:</span>bc<span style="color: #EF5C5F;">:</span>bd<span style="color: #EF5C5F;">:</span>3f<span style="color: #EF5C5F;">:</span>50<span style="color: #EF5C5F;">:</span>92<span style="color: #A197BF;">...</span>
<span style="color: #333333;"> </span><span style="color: #A197BF;">...</span>
<span style="color: #333333;"> </span>51<span style="color: #EF5C5F;">:</span>35<span style="color: #EF5C5F;">:</span>49<span style="color: #EF5C5F;">:</span>8d<span style="color: #EF5C5F;">:</span>c3<span style="color: #EF5C5F;">:</span>9a<span style="color: #EF5C5F;">:</span>bb<span style="color: #A197BF;">...</span>
<span style="color: #333333;"> </span>b8<span style="color: #EF5C5F;">:</span>74
</pre>
</div>
</section>
</section>
<section>
<section id="slide-orgheadline35">
<h3 id="orgheadline35">TLS handshake</h3>

<div class="figure">
<p><img src="./tls_handshake.png" alt="tls_handshake.png" height="550" style="border:none; box-shadow:none;" />
</p>
</div>

</section>
<section>
<ul style="font-size: 90%;">
<li>ClientHello: list of protocol versions/variants supported, the
supported cipher suites in preferred order and a list of
compression algorithms (typically NULL).</li>
<li>ServerHello
<ul>
<li>Returns the selected protocol variant/version number, cipher
suite and compression algorithm.</li>
<li>Also sends 32 byte nonce to compute symmetric keys.</li>
<li>Creates a session ID if it was 0 in ClientHello, or uses
proposed session ID if it was not recently used.</li>

</ul></li>
<li>Certificate:
<ul>
<li>Server sends X.509 certificate to user.</li>
<li>Bundle or cert chain (cross-signed cert).</li>
<li>Validation on user side.</li>

</ul></li>

</ul>

</section>
<section>
<ul style="font-size: 90%;">
<li>ServerDone: end of the server part, invites the Client to
continue the protocol sequence.</li>
<li>ClientKeyExchange:
<ul>
<li>Computes pre-master key using the server and client nonces.</li>
<li>Client shares this key, encrypting it with server's cert
public key.</li>
<li>Both sides then independently compute master key. Required
session keys are derived from it.</li>

</ul></li>
<li>ChangeCipherSpec: message that states that every subsequent
traffic will be encrypted using selected algo. Usually
concatenated with ClientKeyExchange message.</li>
<li>Finished: contains every previous message (sent/received)
encrypted using negotiated bulk encryption protocol. If server
can verify it, the connection is set up. If not good, response is
Alert.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline36">
<h3 id="orgheadline36">TLS record</h3>

<div class="figure">
<p><img src="./tls_record.png" alt="tls_record.png" height="300" style="border:none; box-shadow:none;" />
</p>
</div>

<ul style="font-size: 80%;">
<li><code>content type</code> defines type of message &#x2013; handshake (22),
application (23), alert (21).</li>
<li><code>version</code>: SSL/TLS version.</li>
<li><code>length</code>: the length of Payload, Mac and Padding.</li>
<li>With application type, everything `length` covers is encrypted.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline37">
<h3 id="orgheadline37">TLS applications</h3>
<p>
Everything related to data transfer itself is specific to tls
application. Usually payload is encrypted using symmetric
encryption scheme.
</p>
<ul>
<li>HTTPS: 45% of page loads uses it (measured by Firefox Telemetry)</li>
<li>Mail over TLS: SMTPS, POP3S, IMAPS</li>
<li>File Transfer Protocol (FTP) over TLS: FTPS</li>
<li>Secure web sockets (WSS).</li>
<li>LDAPS to store your passwords.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgheadline39" data-background="./adyhai.jpg" data-background-size="900px" data-background-transition="slide">
<h2 id="orgheadline39">That's all, thank you</h2>
</section>
</section>
<section>
<section id="slide-orgheadline40">
<h2 id="orgheadline40">Resources</h2>
<ul style="font-size: 70%;">
<li><a href="http://www.montefiore.ulg.ac.be/~leduc/cours/ISIR/GSRI-ch5.pdf">http://www.montefiore.ulg.ac.be/~leduc/cours/ISIR/GSRI-ch5.pdf</a></li>
<li><a href="http://unixwiz.net/techtips/iguide-ipsec.html">http://unixwiz.net/techtips/iguide-ipsec.html</a></li>
<li><a href="https://tools.ietf.org/html/rfc4302">https://tools.ietf.org/html/rfc4302</a></li>
<li><a href="http://unix.stackexchange.com/questions/97244/list-all-available-ssl-ca-certificates">http://unix.stackexchange.com/questions/97244/list-all-available-ssl-ca-certificates</a></li>
<li><a href="http://serverfault.com/questions/62496/ssl-certificate-location-on-unix-linux">http://serverfault.com/questions/62496/ssl-certificate-location-on-unix-linux</a></li>
<li><a href="http://www.zytrax.com/tech/survival/ssl.html">http://www.zytrax.com/tech/survival/ssl.html</a></li>
<li><a href="https://www.symantec.com/connect/blogs/how-does-ssl-work-what-ssl-handshake">https://www.symantec.com/connect/blogs/how-does-ssl-work-what-ssl-handshake</a></li>
<li><a href="https://sites.google.com/site/amitsciscozone/home/security/digital-certificates-explained">https://sites.google.com/site/amitsciscozone/home/security/digital-certificates-explained</a></li>
<li><a href="http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session">http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session</a></li>

</ul>
</section>
</section>
</div>
</div>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
margin: 0.10,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'slide', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
